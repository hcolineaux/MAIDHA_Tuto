<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Multilevels models: Simple example - binary outcome | MAIDHA | Very detailed examples</title>
  <meta name="description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Multilevels models: Simple example - binary outcome | MAIDHA | Very detailed examples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Multilevels models: Simple example - binary outcome | MAIDHA | Very detailed examples" />
  
  <meta name="twitter:description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  

<meta name="author" content="H. Colineaux" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="create-stratas.html"/>
<link rel="next" href="multilevels-models-simple-example---continous-outcome.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="create-stratas.html"><a href="create-stratas.html"><i class="fa fa-check"></i><b>2</b> Create stratas</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-stratas.html"><a href="create-stratas.html#choose-variables"><i class="fa fa-check"></i><b>2.1</b> Choose variables</a></li>
<li class="chapter" data-level="2.2" data-path="create-stratas.html"><a href="create-stratas.html#create-strata-variables"><i class="fa fa-check"></i><b>2.2</b> Create strata variables</a></li>
<li class="chapter" data-level="2.3" data-path="create-stratas.html"><a href="create-stratas.html#plots-the-stratas-distribution"><i class="fa fa-check"></i><b>2.3</b> Plots the stratas distribution</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multilevels-models-simple-example---binary-outcome.html"><a href="multilevels-models-simple-example---binary-outcome.html"><i class="fa fa-check"></i><b>3</b> Multilevels models: Simple example - binary outcome</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multilevels-models-simple-example---binary-outcome.html"><a href="multilevels-models-simple-example---binary-outcome.html#description"><i class="fa fa-check"></i><b>3.1</b> Description</a></li>
<li class="chapter" data-level="3.2" data-path="multilevels-models-simple-example---binary-outcome.html"><a href="multilevels-models-simple-example---binary-outcome.html#the-null-model-only-strata"><i class="fa fa-check"></i><b>3.2</b> The null model (only strata)</a></li>
<li class="chapter" data-level="3.3" data-path="multilevels-models-simple-example---binary-outcome.html"><a href="multilevels-models-simple-example---binary-outcome.html#the-variance-change"><i class="fa fa-check"></i><b>3.3</b> The variance change</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="multilevels-models-simple-example---continous-outcome.html"><a href="multilevels-models-simple-example---continous-outcome.html"><i class="fa fa-check"></i><b>4</b> Multilevels models: Simple example - continous outcome</a>
<ul>
<li class="chapter" data-level="4.1" data-path="multilevels-models-simple-example---continous-outcome.html"><a href="multilevels-models-simple-example---continous-outcome.html#description-1"><i class="fa fa-check"></i><b>4.1</b> Description</a></li>
<li class="chapter" data-level="4.2" data-path="multilevels-models-simple-example---continous-outcome.html"><a href="multilevels-models-simple-example---continous-outcome.html#the-null-model-only-strata-1"><i class="fa fa-check"></i><b>4.2</b> The null model (only strata)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MAIDHA | Very detailed examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevels-models-simple-example---binary-outcome" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Multilevels models: Simple example - binary outcome<a href="multilevels-models-simple-example---binary-outcome.html#multilevels-models-simple-example---binary-outcome" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As a working example, we want to explore intersectional inequalities in qualification (a “late” intersectional strata) by early intersectional strata.</p>
<div id="description" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Description<a href="multilevels-models-simple-example---binary-outcome.html#description" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can start by describe the outcome by strata.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb8-1" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> Sex <span class="sc">+</span> Age_class <span class="sc">+</span> Ethnicity <span class="sc">|</span> Qualification,</span>
<span id="cb8-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb8-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>mydata,</span>
<span id="cb8-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">overall=</span><span class="fu">c</span>(<span class="at">left=</span><span class="st">&quot;Total&quot;</span>),</span>
<span id="cb8-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption=</span><span class="st">&quot;Description by qualification level&quot;</span>)</span></code></pre></div>
<div class="Rtable1"><table class="Rtable1"><caption>Description by qualification level</caption>

<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Total<br><span class='stratn'>(N=502461)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Med-High Qualif.<br><span class='stratn'>(N=356623)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Low Qualif.<br><span class='stratn'>(N=145838)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'>Sex</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Women</td>
<td>273354 (54.4%)</td>
<td>187727 (52.6%)</td>
<td>85627 (58.7%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Men</td>
<td class='lastrow'>229107 (45.6%)</td>
<td class='lastrow'>168896 (47.4%)</td>
<td class='lastrow'>60211 (41.3%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'>Age_class</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>-50</td>
<td>132145 (26.3%)</td>
<td>87439 (24.5%)</td>
<td>44706 (30.7%)</td>
</tr>
<tr>
<td class='rowlabel'>51-60</td>
<td>177222 (35.3%)</td>
<td>127965 (35.9%)</td>
<td>49257 (33.8%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>61+</td>
<td class='lastrow'>193094 (38.4%)</td>
<td class='lastrow'>141219 (39.6%)</td>
<td class='lastrow'>51875 (35.6%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'>Ethnicity</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Non White</td>
<td>27037 (5.4%)</td>
<td>20621 (5.8%)</td>
<td>6416 (4.4%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>White</td>
<td class='lastrow'>475424 (94.6%)</td>
<td class='lastrow'>336002 (94.2%)</td>
<td class='lastrow'>139422 (95.6%)</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata,Qualification) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">n</span>()<span class="sc">/</span>tot) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Qualification <span class="sc">==</span> <span class="st">&quot;Low Qualif.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(strata,value,<span class="at">.fun=</span><span class="st">&#39;median&#39;</span>),</span>
<span id="cb9-8"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span>value)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb9-10"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Stratas&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Low Qualification&quot;</span>,</span>
<span id="cb9-11"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Observed percentage by stratas&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-12"><a href="multilevels-models-simple-example---binary-outcome.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,  <span class="at">vjust=</span><span class="dv">1</span>,  <span class="at">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="the-null-model-only-strata" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> The null model (only strata)<a href="multilevels-models-simple-example---binary-outcome.html#the-null-model-only-strata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The null model allows us to estimate the IntraClass correlation (ICC), also known as the Variance Partition Coefficient (VPC), that is the part of the outcome variance that can be explained by the strata.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multilevel model</span></span>
<span id="cb10-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-2" aria-hidden="true" tabindex="-1"></a>m_null <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Qualification <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata),</span>
<span id="cb10-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> mydata,</span>
<span id="cb10-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> binomial)</span>
<span id="cb10-5"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept varies according to the stratum</span></span>
<span id="cb10-7"><a href="multilevels-models-simple-example---binary-outcome.html#cb10-7" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(m_null, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)</span></code></pre></div>
<pre><code>## $strata</code></pre>
<p><img src="_main_files/figure-html/models_1-1.png" width="672" /></p>
<p>Outputs of the models:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_null)</span></code></pre></div>
<pre><code>##  Family: binomial  ( logit )
## Formula:          Qualification ~ 1 + (1 | strata)
## Data: mydata
## 
##       AIC       BIC    logLik  deviance  df.resid 
##  600465.6  600487.8 -300230.8  600461.6    502459 
## 
## Random effects:
## 
## Conditional model:
##  Groups Name        Variance Std.Dev.
##  strata (Intercept) 0.06779  0.2604  
## Number of obs: 502461, groups:  strata, 12
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.03793    0.07558  -13.73   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the variances:</span></span>
<span id="cb14-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb14-2" aria-hidden="true" tabindex="-1"></a>v_null <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_null)</span>
<span id="cb14-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between stratas variance:</span></span>
<span id="cb14-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb14-4" aria-hidden="true" tabindex="-1"></a>v_null<span class="sc">$</span>var.random</span></code></pre></div>
<pre><code>## [1] 0.06778898</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># intraclass correlation </span></span>
<span id="cb16-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb16-2" aria-hidden="true" tabindex="-1"></a>ICC_intersect <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">icc</span>(m_null)<span class="sc">$</span>ICC_unadjusted<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb16-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb16-3" aria-hidden="true" tabindex="-1"></a>ICC_intersect</span></code></pre></div>
<pre><code>## [1] 2.02</code></pre>
<p>Plot of the predicted values by strata:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb18-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict_response</span>(</span>
<span id="cb18-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-3" aria-hidden="true" tabindex="-1"></a>      m_null,</span>
<span id="cb18-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;strata&quot;</span>),</span>
<span id="cb18-5"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;random&quot;</span>) </span>
<span id="cb18-6"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-6" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(predicted) </span>
<span id="cb18-8"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-8" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>rown <span class="ot">=</span> <span class="fu">rownames</span>(predictions)</span>
<span id="cb18-9"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>x_lab <span class="ot">&lt;-</span> <span class="fu">paste0</span>(predictions<span class="sc">$</span>rown,<span class="st">&quot;.&quot;</span>,predictions<span class="sc">$</span>x)</span>
<span id="cb18-10"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-10" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Men&quot;</span>, predictions<span class="sc">$</span>x), <span class="st">&quot;Men&quot;</span>, <span class="st">&quot;Women&quot;</span>))</span>
<span id="cb18-11"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-11" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>ethnicity <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Non white&quot;</span>, predictions<span class="sc">$</span>x), <span class="st">&quot;Non white&quot;</span>, <span class="st">&quot;White&quot;</span>))</span>
<span id="cb18-12"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-12" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;61+&quot;</span>, df<span class="sc">$</span>x), <span class="st">&quot;61+&quot;</span>,</span>
<span id="cb18-13"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-13" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;-50&quot;</span>, df<span class="sc">$</span>x), <span class="st">&quot;-50&quot;</span>,<span class="st">&quot;51-60&quot;</span>)))</span>
<span id="cb18-14"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(predictions <span class="sc">%&gt;%</span> </span>
<span id="cb18-15"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>predicted, <span class="at">y=</span><span class="fu">fct_reorder</span>(x,predicted,<span class="at">.fun=</span><span class="st">&#39;median&#39;</span>),</span>
<span id="cb18-16"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> sex, <span class="at">linetype =</span> ethnicity))<span class="sc">+</span></span>
<span id="cb18-17"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb18-18"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high, <span class="at">size =</span> age))<span class="sc">+</span></span>
<span id="cb18-19"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&quot;Sratas&quot;</span>, </span>
<span id="cb18-20"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb18-21"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;Sex Category&quot;</span>,</span>
<span id="cb18-22"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> <span class="st">&quot;Ethnicity&quot;</span>,</span>
<span id="cb18-23"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb18-24"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Predicted values for having a low qualification&quot;</span>))<span class="sc">+</span></span>
<span id="cb18-25"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb18-26"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>)))<span class="sc">+</span> </span>
<span id="cb18-27"><a href="multilevels-models-simple-example---binary-outcome.html#cb18-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_size_discrete</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%201-1.png" width="672" /><img src="_main_files/figure-html/plot%201-2.png" width="672" /></p>
</div>
<div id="the-variance-change" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> The variance change<a href="multilevels-models-simple-example---binary-outcome.html#the-variance-change" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To calculate the (additive) contribution of each category to the total variance, we can estimate the variance change when adjusting for this category. The Proportional Variance Change (PVC) when adjusting for all categories is the portion of ICC/VPC explained by additive effect. Therefore 100% - PVC is the part explained by an intersectional effect .</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models where we add each category one by one</span></span>
<span id="cb19-2"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-2" aria-hidden="true" tabindex="-1"></a>m_gender <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Qualification <span class="sc">~</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata, <span class="at">family=</span>binomial)</span>
<span id="cb19-3"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-3" aria-hidden="true" tabindex="-1"></a>m_ethnicity <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Qualification <span class="sc">~</span> Ethnicity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata, <span class="at">family=</span>binomial)</span>
<span id="cb19-4"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-4" aria-hidden="true" tabindex="-1"></a>m_age <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Qualification <span class="sc">~</span> Age_class <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata, <span class="at">family=</span>binomial)</span>
<span id="cb19-5"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-5" aria-hidden="true" tabindex="-1"></a>m_full <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Qualification <span class="sc">~</span> Age_class <span class="sc">+</span> Ethnicity <span class="sc">+</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata, <span class="at">family=</span>binomial)</span>
<span id="cb19-6"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-7" aria-hidden="true" tabindex="-1"></a>v_gender <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_gender)</span>
<span id="cb19-8"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-8" aria-hidden="true" tabindex="-1"></a>v_ethnicity <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_ethnicity)</span>
<span id="cb19-9"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-9" aria-hidden="true" tabindex="-1"></a>v_age <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_age)</span>
<span id="cb19-10"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-10" aria-hidden="true" tabindex="-1"></a>v_full <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_full)</span>
<span id="cb19-11"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-12" aria-hidden="true" tabindex="-1"></a>prop_gender <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_gender<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb19-13"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-13" aria-hidden="true" tabindex="-1"></a>prop_gender <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_gender), <span class="dv">0</span>, prop_gender)</span>
<span id="cb19-14"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-15" aria-hidden="true" tabindex="-1"></a>prop_ethnicity <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_ethnicity<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb19-16"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-16" aria-hidden="true" tabindex="-1"></a>prop_ethnicity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_ethnicity), <span class="dv">0</span>, prop_ethnicity)</span>
<span id="cb19-17"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-18" aria-hidden="true" tabindex="-1"></a>prop_age <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_age<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb19-19"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-19" aria-hidden="true" tabindex="-1"></a>prop_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_age), <span class="dv">0</span>, prop_age)</span>
<span id="cb19-20"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-21" aria-hidden="true" tabindex="-1"></a>prop_full <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_full<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb19-22"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-22" aria-hidden="true" tabindex="-1"></a>prop_full <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_full), <span class="dv">100</span>, prop_full)</span>
<span id="cb19-23"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-23" aria-hidden="true" tabindex="-1"></a>prop_intersection <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">-</span> prop_full,<span class="dv">2</span>)</span>
<span id="cb19-24"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb19-27"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(</span>
<span id="cb19-28"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(</span>
<span id="cb19-29"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">c</span>(<span class="st">&quot;ICC/VPC&quot;</span>, <span class="st">&quot;% Sex category&quot;</span>, <span class="st">&quot;% Age/generation&quot;</span>, <span class="st">&quot;% Ethnicity&quot;</span>, <span class="st">&quot;%Intersection&quot;</span>),</span>
<span id="cb19-30"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(ICC_intersect,prop_gender, prop_age, prop_ethnicity,prop_intersection )</span>
<span id="cb19-31"><a href="multilevels-models-simple-example---binary-outcome.html#cb19-31" aria-hidden="true" tabindex="-1"></a>  )))</span></code></pre></div>
<pre><code>##         parameters values
## 1          ICC/VPC   2.02
## 2   % Sex category   22.9
## 3 % Age/generation  19.84
## 4      % Ethnicity  42.77
## 5    %Intersection  14.29</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="create-stratas.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevels-models-simple-example---continous-outcome.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
