[["index.html", "MAIDHA | Very detailed examples 1 About", " MAIDHA | Very detailed examples H. Colineaux Last compiled on 16 January, 2025 1 About We were largely inspired by the work of Evans et al (for example: Evans et al. (2024)) and the vignette in the [ggeffects]:https://strengejacke.github.io/ggeffects/articles/practical_intersectionality.html package. The online version of this book is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. "],["create-stratas.html", "2 Create stratas 2.1 Choose variables 2.2 Definition and description 2.3 Create strata variables 2.4 Plots the stratas distribution", " 2 Create stratas 2.1 Choose variables For the first example, we use real data from the UKBB. This is an exploratory and not a confirmatory analysis, the results are purely didactic and cannot be really interpreted. In particular, for simplicity, a simple imputation of missing data (KNN) has been carried out, which may affect the results. 2.1.1 A first simple exemple (12 strata) To define strata, we choose the following variables: age, by classes “-50,” “51-60,” “61+” declared binary sex category (men or women), ethnicity (white or non-white). Outcomes will be 4th later intersectional categories describing cultural/intellectual ressources, i.e.  either age at the end of education (quantitative variables) or level of qualification (binary variable). There are no variables characterizing socio-economic position at the start of life in this dataset, such as parent social class or income. 2.1.2 A second exemple (48 strata) In a second step, we use to define intersectional strata: age, by classes “-50,” “51-60,” “61+” declared binary sex category (men or women), ethnicity (white or non-white) level of qualification (medium/high, low) and life place (rural, urban) The outcomes were: feeling lonely (binary outcomes) exposition to air pollution (pm10, ugm3). 2.2 Definition and description mydata$Sex &lt;- factor(round(mydata$Sex), labels = c(&quot;Women&quot;,&quot;Men&quot;)) mydata$Ethnicity &lt;- factor(round(mydata$Ethnicity), label = c(&quot;Non White&quot;,&quot;White&quot;)) mydata &lt;- mydata %&gt;% # recode age into three groups mutate(Age_class = round(Age)) %&gt;% recode_values( select = &quot;Age_class&quot;, recode = list(`1` = &quot;min:50&quot;, `2` = 51:60, `3` = &quot;61:max&quot;)) %&gt;% mutate(Age_class = factor(Age_class, labels = c(&quot;-50&quot;, &quot;51-60&quot;, &quot;61+&quot;))) mydata$Qualification &lt;- factor(round(mydata$Qualification), labels = c(&quot;Med-High Qualif.&quot;, &quot;Low Qualif.&quot;)) mydata$Urban &lt;- factor(round(mydata$Urban), labels = c(&quot;Rural&quot;, &quot;Urban&quot;)) mydata$Loneliness &lt;- factor(round(mydata$Loneliness), labels = c(&quot;No&quot;, &quot;Yes&quot;)) table1::table1(~ Sex + Age + Ethnicity + AgeEducEnd + Qualification + Urban + Loneliness + AirPoll_PM10, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Description&quot;) Description Total(N=502461) Sex Women 273354 (54.4%) Men 229107 (45.6%) Age Mean (SD) 56.5 (8.10) Median [Min, Max] 58.0 [37.0, 73.0] Ethnicity Non White 27037 (5.4%) White 475424 (94.6%) AgeEducEnd Mean (SD) 16.8 (1.98) Median [Min, Max] 16.1 [5.00, 35.0] Qualification Med-High Qualif. 356623 (71.0%) Low Qualif. 145838 (29.0%) Urban Rural 68955 (13.7%) Urban 433506 (86.3%) Loneliness No 410974 (81.8%) Yes 91487 (18.2%) AirPoll_PM10 Mean (SD) 16.2 (1.86) Median [Min, Max] 16.1 [11.8, 31.4] 2.3 Create strata variables 2.3.1 For the first exemple (12 strata) To create the stratas, I use the method describe in the vignette in the [ggeffects]:https://strengejacke.github.io/ggeffects/articles/practical_intersectionality.html package. This involves concatenating the labels of the different variables. Remember to name the variable in the label, for example Ethnicity[White;Non White] rather than White[Yes;No]. mydata$strata &lt;- ifelse( is.na(mydata$Sex) | is.na(mydata$Ethnicity) | is.na(mydata$Age_class), NA_character_, paste0(mydata$Sex, &quot;, &quot;, mydata$Ethnicity, &quot;, &quot;, mydata$Age_class) ) mydata$strata &lt;- factor(mydata$strata) We have 12 stratas # data_tabulate(mydata$strata) table1::table1(~ strata, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Stratas (12)&quot;) Stratas (12) Total(N=502461) strata Men, Non White, -50 5749 (1.1%) Men, Non White, 51-60 3856 (0.8%) Men, Non White, 61+ 2754 (0.5%) Men, White, -50 53729 (10.7%) Men, White, 51-60 73877 (14.7%) Men, White, 61+ 89142 (17.7%) Women, Non White, -50 6652 (1.3%) Women, Non White, 51-60 5149 (1.0%) Women, Non White, 61+ 2877 (0.6%) Women, White, -50 66015 (13.1%) Women, White, 51-60 94340 (18.8%) Women, White, 61+ 98321 (19.6%) 2.3.2 For the second exemple (48 strata) And with more categories: mydata$strata_2 &lt;- ifelse( is.na(mydata$Sex) | is.na(mydata$Ethnicity) | is.na(mydata$Age_class) | is.na(mydata$Qualification) | is.na(mydata$Urban), NA_character_, paste0(mydata$Sex, &quot;, &quot;, mydata$Ethnicity, &quot;, &quot;, mydata$Age_class,&quot;, &quot;, mydata$Qualification,&quot;, &quot;, mydata$Urban) ) We have 48 stratas mydata$strata_2 &lt;- factor(mydata$strata_2) table1::table1(~ strata_2, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Stratas (48)&quot;) Stratas (48) Total(N=502461) strata_2 Men, Non White, -50, Low Qualif., Rural 23 (0.0%) Men, Non White, -50, Low Qualif., Urban 1254 (0.2%) Men, Non White, -50, Med-High Qualif., Rural 111 (0.0%) Men, Non White, -50, Med-High Qualif., Urban 4361 (0.9%) Men, Non White, 51-60, Low Qualif., Rural 24 (0.0%) Men, Non White, 51-60, Low Qualif., Urban 739 (0.1%) Men, Non White, 51-60, Med-High Qualif., Rural 96 (0.0%) Men, Non White, 51-60, Med-High Qualif., Urban 2997 (0.6%) Men, Non White, 61+, Low Qualif., Rural 13 (0.0%) Men, Non White, 61+, Low Qualif., Urban 531 (0.1%) Men, Non White, 61+, Med-High Qualif., Rural 77 (0.0%) Men, Non White, 61+, Med-High Qualif., Urban 2133 (0.4%) Men, White, -50, Low Qualif., Rural 2088 (0.4%) Men, White, -50, Low Qualif., Urban 16687 (3.3%) Men, White, -50, Med-High Qualif., Rural 4483 (0.9%) Men, White, -50, Med-High Qualif., Urban 30471 (6.1%) Men, White, 51-60, Low Qualif., Rural 2350 (0.5%) Men, White, 51-60, Low Qualif., Urban 16154 (3.2%) Men, White, 51-60, Med-High Qualif., Rural 7991 (1.6%) Men, White, 51-60, Med-High Qualif., Urban 47382 (9.4%) Men, White, 61+, Low Qualif., Rural 3058 (0.6%) Men, White, 61+, Low Qualif., Urban 17290 (3.4%) Men, White, 61+, Med-High Qualif., Rural 10749 (2.1%) Men, White, 61+, Med-High Qualif., Urban 58045 (11.6%) Women, Non White, -50, Low Qualif., Rural 51 (0.0%) Women, Non White, -50, Low Qualif., Urban 1698 (0.3%) Women, Non White, -50, Med-High Qualif., Rural 152 (0.0%) Women, Non White, -50, Med-High Qualif., Urban 4751 (0.9%) Women, Non White, 51-60, Low Qualif., Rural 27 (0.0%) Women, Non White, 51-60, Low Qualif., Urban 1406 (0.3%) Women, Non White, 51-60, Med-High Qualif., Rural 132 (0.0%) Women, Non White, 51-60, Med-High Qualif., Urban 3584 (0.7%) Women, Non White, 61+, Low Qualif., Rural 26 (0.0%) Women, Non White, 61+, Low Qualif., Urban 624 (0.1%) Women, Non White, 61+, Med-High Qualif., Rural 63 (0.0%) Women, Non White, 61+, Med-High Qualif., Urban 2164 (0.4%) Women, White, -50, Low Qualif., Rural 2811 (0.6%) Women, White, -50, Low Qualif., Urban 20094 (4.0%) Women, White, -50, Med-High Qualif., Rural 5729 (1.1%) Women, White, -50, Med-High Qualif., Urban 37381 (7.4%) Women, White, 51-60, Low Qualif., Rural 3965 (0.8%) Women, White, 51-60, Low Qualif., Urban 24592 (4.9%) Women, White, 51-60, Med-High Qualif., Rural 9856 (2.0%) Women, White, 51-60, Med-High Qualif., Urban 55927 (11.1%) Women, White, 61+, Low Qualif., Rural 4801 (1.0%) Women, White, 61+, Low Qualif., Urban 25532 (5.1%) Women, White, 61+, Med-High Qualif., Rural 10279 (2.0%) Women, White, 61+, Med-High Qualif., Urban 57709 (11.5%) In this case, some stratas are very small. tab &lt;- data_tabulate(mydata$strata_2) tab &lt;- tab[1:48,] min(tab$N) ## [1] 13 max(tab$N) ## [1] 58045 2.4 Plots the stratas distribution 2.4.1 For the first exemple df &lt;- data.frame(x = names(table(mydata$strata)), p = as.numeric(table(mydata$strata))/length(mydata$strata), n = as.numeric(table(mydata$strata))) df$sex = as.factor(ifelse(grepl(&quot;Men&quot;, df$x), &quot;Men&quot;, &quot;Women&quot;)) df$ethnicity &lt;- as.factor(ifelse(grepl(&quot;Non White&quot;, df$x), &quot;Non White&quot;, &quot;White&quot;)) df$age &lt;- as.factor(ifelse(grepl(&quot;61+&quot;, df$x), &quot;61+&quot;, ifelse(grepl(&quot;-50&quot;, df$x), &quot;-50&quot;,&quot;51-60&quot;))) jpeg(&quot;img/plot_stata_1.jpeg&quot;, width = 800, height = &quot;500&quot;) ggplot(data = df) + geom_col(aes(x = fct_reorder(x,n,.fun=&#39;median&#39;), y = n, linewidth = age, fill = ethnicity), color = &quot;black&quot;) + geom_point(aes(x = fct_reorder(x,n,.fun=&#39;median&#39;), y = n, color = sex), size =4) + theme(plot.margin = margin(1,1,1.5,2, &quot;cm&quot;))+ labs (x=&quot;&quot;, y = &quot;N&quot;, fill = &quot;Ethnicity&quot;) + theme(axis.text.x = element_text(angle = 45, vjust=1, hjust=1))+ scale_linewidth_discrete(range = c(0.5, 1))+ # scale_y_log10() scale_y_continuous(breaks = c(1000, 10000, 25000,50000, 75000))+ scale_shape_manual(values=c(19, 15)) dev.off() ## png ## 2 2.4.2 For the second exemple df_2 &lt;- data.frame(x = names(table(mydata$strata_2)), p = as.numeric(table(mydata$strata_2))/length(mydata$strata_2), n = as.numeric(table(mydata$strata_2))) df_2$sex = as.factor(ifelse(grepl(&quot;Men&quot;, df_2$x), &quot;Men&quot;, &quot;Women&quot;)) df_2$ethnicity &lt;- as.factor(ifelse(grepl(&quot;Non White&quot;, df_2$x), &quot;Non White&quot;, &quot;White&quot;)) df_2$age &lt;- as.factor(ifelse(grepl(&quot;61+&quot;, df_2$x), &quot;61+&quot;, ifelse(grepl(&quot;-50&quot;, df_2$x), &quot;-50&quot;,&quot;51-60&quot;))) df_2$qualification &lt;- as.factor(ifelse(grepl(&quot;Low&quot;, df_2$x), &quot;Low&quot;, &quot;Med-High&quot;)) df_2$LocalArea &lt;- as.factor(ifelse(grepl(&quot;Urban&quot;, df_2$x), &quot;Urban&quot;, &quot;Rural&quot;)) jpeg(&quot;img/plot_stata_2.jpeg&quot;, width = 1200, height = &quot;800&quot;) ggplot(data = df_2) + geom_col(aes(x = fct_reorder(x,n,.fun=&#39;median&#39;), y = n, linewidth = age, fill = ethnicity, alpha = LocalArea), color = &quot;black&quot;) + geom_point(aes(x = fct_reorder(x,n,.fun=&#39;median&#39;), y = n, shape = qualification, color = sex), size =4) + theme(plot.margin = margin(1,1,1.5,2, &quot;cm&quot;))+ labs (x=&quot;&quot;, y = &quot;N&quot;, fill = &quot;Ethnicity&quot;) + theme(axis.text.x = element_text(angle = 45, vjust=1, hjust=1))+ scale_alpha_discrete(range = c(0.5, 1))+ scale_linewidth_discrete(range = c(0.5, 1))+ # scale_y_log10() scale_y_continuous(breaks = c(1000, 10000, 20000,30000,40000,50000))+ scale_shape_manual(values=c(19, 15)) dev.off() ## png ## 2 "],["simple-example---binary-outcome.html", "3 Simple example - binary outcome 3.1 Description 3.2 The null model (only strata) 3.3 The variance change", " 3 Simple example - binary outcome As a working example, we want to explore intersectional inequalities in qualification (a “late” intersectional strata) by early intersectional strata (12 stratas). 3.1 Description We can start by describe the outcome by strata. table1::table1(~ Sex + Age_class + Ethnicity | Qualification, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Description by qualification level&quot;) Description by qualification level Total(N=502461) Med-High Qualif.(N=356623) Low Qualif.(N=145838) Sex Women 273354 (54.4%) 187727 (52.6%) 85627 (58.7%) Men 229107 (45.6%) 168896 (47.4%) 60211 (41.3%) Age_class -50 132145 (26.3%) 87439 (24.5%) 44706 (30.7%) 51-60 177222 (35.3%) 127965 (35.9%) 49257 (33.8%) 61+ 193094 (38.4%) 141219 (39.6%) 51875 (35.6%) Ethnicity Non White 27037 (5.4%) 20621 (5.8%) 6416 (4.4%) White 475424 (94.6%) 336002 (94.2%) 139422 (95.6%) We can plot the observed probability. jpeg(&quot;img/plot_12_quali.jpeg&quot;, width = 1200, height = &quot;800&quot;) mydata %&gt;% group_by(strata) %&gt;% mutate(tot = n()) %&gt;% ungroup() %&gt;% group_by(strata,Qualification) %&gt;% mutate(value = n()/tot) %&gt;% filter(Qualification == &quot;Low Qualif.&quot;) %&gt;% ggplot(aes(x = fct_reorder(strata,value,.fun=&#39;median&#39;), y =value)) + geom_point() + labs(x = &quot;Stratas&quot;, y = &quot;Low Qualification&quot;, title = &quot;Observed percentage by stratas&quot;) + theme(axis.text.x = element_text(angle = 45, vjust=1, hjust=1)) dev.off() ## png ## 2 3.2 The null model (only strata) The null model allows us to estimate the IntraClass correlation (ICC), also known as the Variance Partition Coefficient (VPC), that is the part of the outcome variance that can be explained by the strata. # multilevel model m_null &lt;- glmmTMB(Qualification ~ 1 + (1 | strata), data = mydata, family = binomial) # intercept varies according to the stratum jpeg(&quot;img/models_1.jpeg&quot;, width = 1200, height = &quot;800&quot;) sjPlot::plot_model(m_null, type = &quot;diag&quot;) ## $strata dev.off() ## png ## 2 Outputs of the models: summary(m_null) ## Family: binomial ( logit ) ## Formula: Qualification ~ 1 + (1 | strata) ## Data: mydata ## ## AIC BIC logLik deviance df.resid ## 600465.6 600487.8 -300230.8 600461.6 502459 ## ## Random effects: ## ## Conditional model: ## Groups Name Variance Std.Dev. ## strata (Intercept) 0.06779 0.2604 ## Number of obs: 502461, groups: strata, 12 ## ## Conditional model: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -1.03793 0.07558 -13.73 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 # get the variances: v_null &lt;- get_variance(m_null) # between stratas variance: v_null$var.random ## [1] 0.06778898 # intraclass correlation ICC_intersect &lt;- round(icc(m_null)$ICC_unadjusted*100, 2) ICC_intersect ## [1] 2.02 Plot of the predicted values by strata: #plot predictions &lt;- predict_response( m_null, c(&quot;strata&quot;), type = &quot;random&quot;) predictions &lt;- predictions %&gt;% arrange(predicted) predictions$rown = rownames(predictions) predictions$x_lab &lt;- paste0(predictions$rown,&quot;.&quot;,predictions$x) predictions$sex &lt;- as.factor(ifelse(grepl(&quot;Men&quot;, predictions$x), &quot;Men&quot;, &quot;Women&quot;)) predictions$ethnicity &lt;- as.factor(ifelse(grepl(&quot;Non White&quot;, predictions$x), &quot;Non white&quot;, &quot;White&quot;)) predictions$age &lt;- as.factor(ifelse(grepl(&quot;61+&quot;, df$x), &quot;61+&quot;, ifelse(grepl(&quot;-50&quot;, df$x), &quot;-50&quot;,&quot;51-60&quot;))) jpeg(&quot;img/plot.jpeg&quot;, width = 1200, height = &quot;800&quot;) print(predictions %&gt;% ggplot(aes(x=predicted, y=fct_reorder(x,predicted,.fun=&#39;median&#39;), color = sex, linetype = ethnicity))+ geom_point(size=3) + geom_linerange(aes(xmin = conf.low, xmax = conf.high, size = age))+ labs( y = &quot;Sratas&quot;, x = &quot;&quot;, color = &quot;Sex Category&quot;, linetype = &quot;Ethnicity&quot;, size = &quot;Age&quot;, title = paste(&quot;Predicted values for having a low qualification&quot;))+ theme(axis.title = element_text(size = 10), axis.text=element_text(size=10)))+ scale_size_discrete(range = c(0.5, 1.5)) dev.off() ## png ## 2 3.3 The variance change To calculate the (additive) contribution of each category to the total variance, we can estimate the variance change when adjusting for this category. The Proportional Variance Change (PVC) when adjusting for all categories is the portion of ICC/VPC explained by additive effect. Therefore 100% - PVC is the part explained by an intersectional effect . # models where we add each category one by one m_gender &lt;- glmmTMB(Qualification ~ Sex + (1 | strata), data = mydata, family=binomial) m_ethnicity &lt;- glmmTMB(Qualification ~ Ethnicity + (1 | strata), data = mydata, family=binomial) m_age &lt;- glmmTMB(Qualification ~ Age_class + (1 | strata), data = mydata, family=binomial) m_full &lt;- glmmTMB(Qualification ~ Age_class + Ethnicity + Sex + (1 | strata), data = mydata, family=binomial) v_gender &lt;- get_variance(m_gender) v_ethnicity &lt;- get_variance(m_ethnicity) v_age &lt;- get_variance(m_age) v_full &lt;- get_variance(m_full) prop_gender &lt;- round(((v_null$var.random - v_gender$var.random) / v_null$var.random)*100,2) prop_gender &lt;- ifelse(is.null(prop_gender), 0, prop_gender) prop_ethnicity &lt;- round(((v_null$var.random - v_ethnicity$var.random) / v_null$var.random)*100,2) prop_ethnicity &lt;- ifelse(is.null(prop_ethnicity), 0, prop_ethnicity) prop_age &lt;- round(((v_null$var.random - v_age$var.random) / v_null$var.random)*100,2) prop_age &lt;- ifelse(is.null(prop_age), 0, prop_age) prop_full &lt;- round(((v_null$var.random - v_full$var.random) / v_null$var.random)*100,2) prop_full &lt;- ifelse(is.null(prop_full), 100, prop_full) prop_intersection &lt;- round(100 - prop_full,2) print( as.data.frame( cbind( parameters = c(&quot;ICC/VPC&quot;, &quot;% Sex category&quot;, &quot;% Age/generation&quot;, &quot;% Ethnicity&quot;, &quot;%Intersection&quot;), values = c(ICC_intersect,prop_gender, prop_age, prop_ethnicity,prop_intersection ) ))) ## parameters values ## 1 ICC/VPC 2.02 ## 2 % Sex category 22.9 ## 3 % Age/generation 19.84 ## 4 % Ethnicity 42.77 ## 5 %Intersection 14.29 ICC is 2.02%, which is low. This differences is mainly explained by ethnicity (42.77%), age (19.84%) and an intersectional effect (14.29%). "],["simple-example---continous-outcome.html", "4 Simple example - continous outcome 4.1 Description 4.2 The null model (only strata) 4.3 The variance change", " 4 Simple example - continous outcome As a working example, we want to explore intersectional inequalities in educaion length (a “late” intersectional strata) by early intersectional strata (12 stratas). 4.1 Description mydata$AgeEducEnd_class &lt;- as.factor(ifelse(mydata$AgeEducEnd &lt; mean(mydata$AgeEducEnd), &quot;Below mean&quot;, &quot;Above mean&quot;)) table1::table1(~ Sex + Age_class + Ethnicity | AgeEducEnd_class, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Description by age of education end&quot;) Description by age of education end Total(N=502461) Above mean(N=199714) Below mean(N=302747) Sex Women 273354 (54.4%) 110322 (55.2%) 163032 (53.9%) Men 229107 (45.6%) 89392 (44.8%) 139715 (46.1%) Age_class -50 132145 (26.3%) 62549 (31.3%) 69596 (23.0%) 51-60 177222 (35.3%) 73933 (37.0%) 103289 (34.1%) 61+ 193094 (38.4%) 63232 (31.7%) 129862 (42.9%) Ethnicity Non White 27037 (5.4%) 14679 (7.4%) 12358 (4.1%) White 475424 (94.6%) 185035 (92.7%) 290389 (95.9%) We can plot the observed probability. jpeg(&quot;img/plot_12_quanti.jpeg&quot;, width = 1200, height = &quot;800&quot;) mydata %&gt;% group_by(strata) %&gt;% mutate(value = mean(AgeEducEnd)) %&gt;% ggplot(aes(x = fct_reorder(strata,value,.fun=&#39;median&#39;), y =value)) + geom_point() + labs(x = &quot;Stratas&quot;, y = &quot;Age of Education End&quot;, title = &quot;Observed mean by stratas&quot;) + theme(axis.text.x = element_text(angle = 45, vjust=1, hjust=1)) dev.off() ## png ## 2 4.2 The null model (only strata) The null model allows us to estimate the IntraClass correlation (ICC), also known as the Variance Partition Coefficient (VPC), that is the part of the outcome variance that can be explained by the strata. # multilevel model m_null &lt;- glmmTMB(AgeEducEnd ~ 1 + (1 | strata), data = mydata) Outputs of the models: summary(m_null) ## Family: gaussian ( identity ) ## Formula: AgeEducEnd ~ 1 + (1 | strata) ## Data: mydata ## ## AIC BIC logLik deviance df.resid ## 2101612 2101645 -1050803 2101606 502458 ## ## Random effects: ## ## Conditional model: ## Groups Name Variance Std.Dev. ## strata (Intercept) 0.2157 0.4645 ## Residual 3.8366 1.9587 ## Number of obs: 502461, groups: strata, 12 ## ## Dispersion estimate for gaussian family (sigma^2): 3.84 ## ## Conditional model: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 17.1696 0.1342 127.9 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 # get the variances: v_null &lt;- get_variance(m_null) # between stratas variance: v_null$var.random ## [1] 0.2157245 # intraclass correlation ICC_intersect &lt;- round(icc(m_null)$ICC_unadjusted*100, 2) ICC_intersect ## [1] 5.32 Plot of the predicted values by strata: #plot predictions &lt;- predict_response( m_null, c(&quot;strata&quot;), type = &quot;random&quot;) predictions &lt;- predictions %&gt;% arrange(predicted) predictions$rown = rownames(predictions) predictions$x_lab &lt;- paste0(predictions$rown,&quot;.&quot;,predictions$x) predictions$sex &lt;- as.factor(ifelse(grepl(&quot;Men&quot;, predictions$x), &quot;Men&quot;, &quot;Women&quot;)) predictions$ethnicity &lt;- as.factor(ifelse(grepl(&quot;Non White&quot;, predictions$x), &quot;Non white&quot;, &quot;White&quot;)) predictions$age &lt;- as.factor(ifelse(grepl(&quot;61+&quot;, df$x), &quot;61+&quot;, ifelse(grepl(&quot;-50&quot;, df$x), &quot;-50&quot;,&quot;51-60&quot;))) jpeg(&quot;img/plot_quanti.jpeg&quot;, width = 1200, height = &quot;800&quot;) print(predictions %&gt;% ggplot(aes(x=predicted, y=fct_reorder(x,predicted,.fun=&#39;median&#39;), color = sex, linetype = ethnicity))+ geom_point(size=3) + geom_linerange(aes(xmin = conf.low, xmax = conf.high, size = age))+ labs( y = &quot;Sratas&quot;, x = &quot;&quot;, color = &quot;Sex Category&quot;, linetype = &quot;Ethnicity&quot;, size = &quot;Age&quot;, title = paste(&quot;Predicted values for Age of Education End&quot;))+ theme(axis.title = element_text(size = 10), axis.text=element_text(size=10)))+ scale_size_discrete(range = c(0.5, 1.5)) dev.off() ## png ## 2 4.3 The variance change To calculate the (additive) contribution of each category to the total variance, we can estimate the variance change when adjusting for this category. The Proportional Variance Change (PVC) when adjusting for all categories is the portion of ICC/VPC explained by additive effect. Therefore 100% - PVC is the part explained by an intersectional effect . # models where we add each category one by one m_gender &lt;- glmmTMB(AgeEducEnd ~ Sex + (1 | strata), data = mydata) m_ethnicity &lt;- glmmTMB(AgeEducEnd ~ Ethnicity + (1 | strata), data = mydata) m_age &lt;- glmmTMB(AgeEducEnd ~ Age_class + (1 | strata), data = mydata) m_full &lt;- glmmTMB(AgeEducEnd ~ Age_class + Ethnicity + Sex + (1 | strata), data = mydata) v_gender &lt;- get_variance(m_gender) v_ethnicity &lt;- get_variance(m_ethnicity) v_age &lt;- get_variance(m_age) v_full &lt;- get_variance(m_full) prop_gender &lt;- round(((v_null$var.random - v_gender$var.random) / v_null$var.random)*100,2) prop_gender &lt;- ifelse(is.null(prop_gender), 0, prop_gender) prop_ethnicity &lt;- round(((v_null$var.random - v_ethnicity$var.random) / v_null$var.random)*100,2) prop_ethnicity &lt;- ifelse(is.null(prop_ethnicity), 0, prop_ethnicity) prop_age &lt;- round(((v_null$var.random - v_age$var.random) / v_null$var.random)*100,2) prop_age &lt;- ifelse(is.null(prop_age), 0, prop_age) prop_full &lt;- round(((v_null$var.random - v_full$var.random) / v_null$var.random)*100,2) prop_full &lt;- ifelse(is.null(prop_full), 100, prop_full) prop_intersection &lt;- round(100 - prop_full,2) print( as.data.frame( cbind( parameters = c(&quot;ICC/VPC&quot;, &quot;% Sex category&quot;, &quot;% Age/generation&quot;, &quot;% Ethnicity&quot;, &quot;%Intersection&quot;), values = c(ICC_intersect,prop_gender, prop_age, prop_ethnicity,prop_intersection ) ))) ## parameters values ## 1 ICC/VPC 5.32 ## 2 % Sex category 2.59 ## 3 % Age/generation 9.55 ## 4 % Ethnicity 81.07 ## 5 %Intersection 6.62 ICC is 5.32%, which is moderate. This differences is mainly explained by ethnicity (81.07%), age (9.55%) and an intersectional effect (6.62%). "],["more-complexe-example---binary-outcome.html", "5 More complexe example - binary outcome 5.1 Description 5.2 The null model (only strata) 5.3 The variance change", " 5 More complexe example - binary outcome As a working example, we want to explore intersectional inequalities in loneliness by intersectional strata (48 stratas). 5.1 Description We can start by describe the outcome by strata. table1::table1(~ Sex + Age_class + Ethnicity + Qualification + Urban | Loneliness, data=mydata, overall=c(left=&quot;Total&quot;), caption=&quot;Description by qualification level&quot;) Description by qualification level Total(N=502461) No(N=410974) Yes(N=91487) Sex Women 273354 (54.4%) 216268 (52.6%) 57086 (62.4%) Men 229107 (45.6%) 194706 (47.4%) 34401 (37.6%) Age_class -50 132145 (26.3%) 104622 (25.5%) 27523 (30.1%) 51-60 177222 (35.3%) 143277 (34.9%) 33945 (37.1%) 61+ 193094 (38.4%) 163075 (39.7%) 30019 (32.8%) Ethnicity Non White 27037 (5.4%) 20200 (4.9%) 6837 (7.5%) White 475424 (94.6%) 390774 (95.1%) 84650 (92.5%) Qualification Med-High Qualif. 356623 (71.0%) 293532 (71.4%) 63091 (69.0%) Low Qualif. 145838 (29.0%) 117442 (28.6%) 28396 (31.0%) Urban Rural 68955 (13.7%) 58809 (14.3%) 10146 (11.1%) Urban 433506 (86.3%) 352165 (85.7%) 81341 (88.9%) We can plot the observed probability. jpeg(&quot;img/plot_12_quali_2.jpeg&quot;, width = 1200, height = &quot;800&quot;) mydata %&gt;% group_by(strata_2) %&gt;% mutate(tot = n()) %&gt;% ungroup() %&gt;% group_by(strata_2,Loneliness) %&gt;% mutate(value = n()/tot) %&gt;% filter(Loneliness == &quot;Yes&quot;) %&gt;% ggplot(aes(x = fct_reorder(strata,value,.fun=&#39;median&#39;), y =value)) + geom_point() + labs(x = &quot;Stratas&quot;, y = &quot;Loneliness&quot;, title = &quot;Observed percentage by stratas&quot;) + theme(axis.text.x = element_text(angle = 45, vjust=1, hjust=1)) dev.off() ## png ## 2 5.2 The null model (only strata) The null model allows us to estimate the IntraClass correlation (ICC), also known as the Variance Partition Coefficient (VPC), that is the part of the outcome variance that can be explained by the strata. # multilevel model m_null &lt;- glmmTMB(Loneliness ~ 1 + (1 | strata_2), data = mydata, family = binomial) # intercept varies according to the stratum jpeg(&quot;img/models_1_2.jpeg&quot;, width = 1200, height = &quot;800&quot;) sjPlot::plot_model(m_null, type = &quot;diag&quot;) ## $strata_2 dev.off() ## png ## 2 Outputs of the models: summary(m_null) ## Family: binomial ( logit ) ## Formula: Loneliness ~ 1 + (1 | strata_2) ## Data: mydata ## ## AIC BIC logLik deviance df.resid ## 470876.0 470898.2 -235436.0 470872.0 502459 ## ## Random effects: ## ## Conditional model: ## Groups Name Variance Std.Dev. ## strata_2 (Intercept) 0.134 0.3661 ## Number of obs: 502461, groups: strata_2, 48 ## ## Conditional model: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -1.47114 0.05684 -25.88 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 # get the variances: v_null &lt;- get_variance(m_null) # between stratas variance: v_null$var.random ## [1] 0.134028 # intraclass correlation ICC_intersect &lt;- round(icc(m_null)$ICC_unadjusted*100, 2) ICC_intersect ## [1] 3.91 Plot of the predicted values by strata: #plot predictions &lt;- predict_response( m_null, c(&quot;strata_2&quot;), type = &quot;random&quot;) predictions &lt;- predictions %&gt;% arrange(predicted) predictions$rown = rownames(predictions) predictions$x_lab &lt;- paste0(predictions$rown,&quot;.&quot;,predictions$x) predictions$sex &lt;- as.factor(ifelse(grepl(&quot;Men&quot;, predictions$x), &quot;Men&quot;, &quot;Women&quot;)) predictions$ethnicity &lt;- as.factor(ifelse(grepl(&quot;Non White&quot;, predictions$x), &quot;Non white&quot;, &quot;White&quot;)) predictions$age &lt;- as.factor(ifelse(grepl(&quot;61+&quot;, df$x), &quot;61+&quot;, ifelse(grepl(&quot;-50&quot;, df$x), &quot;-50&quot;,&quot;51-60&quot;))) predictions$qualification &lt;- as.factor(ifelse(grepl(&quot;Low&quot;, predictions$x), &quot;Low&quot;, &quot;Med-High&quot;)) predictions$localarea &lt;- as.factor(ifelse(grepl(&quot;Urban&quot;, predictions$x), &quot;Urban&quot;, &quot;Rural&quot;)) jpeg(&quot;img/plot_2.jpeg&quot;, width = 1200, height = &quot;800&quot;) print(predictions %&gt;% ggplot(aes(x=predicted, y=fct_reorder(x,predicted,.fun=&#39;median&#39;), color = sex, linetype = ethnicity))+ geom_point(aes(shape = qualification, alpha = localarea),size=3) + geom_linerange(aes(xmin = conf.low, xmax = conf.high, size = age)) + labs(y = &quot;Sratas&quot;, x = &quot;&quot;, shape = &quot;Qualification&quot;, alpha = &quot;Life place&quot;, size = &quot;Age class&quot;, color = &quot;Sex category&quot;, linetype = &quot;Ethnicity&quot;, title = &quot;Predicted values for Loneliness&quot;) + theme(axis.title = element_text(size = 10)) + scale_size_discrete(range = c(0.5, 1.5)) + scale_alpha_discrete(range = c(0.5, 1))) dev.off() ## png ## 2 5.3 The variance change To calculate the (additive) contribution of each category to the total variance, we can estimate the variance change when adjusting for this category. The Proportional Variance Change (PVC) when adjusting for all categories is the portion of ICC/VPC explained by additive effect. Therefore 100% - PVC is the part explained by an intersectional effect . # models where we add each category one by one m_gender &lt;- glmmTMB(Loneliness ~ Sex + (1 | strata_2), data = mydata, family=binomial) m_ethnicity &lt;- glmmTMB(Loneliness ~ Ethnicity + (1 | strata_2), data = mydata, family=binomial) m_age &lt;- glmmTMB(Loneliness ~ Age_class + (1 | strata_2), data = mydata, family=binomial) m_urban &lt;- glmmTMB(Loneliness ~ Urban + (1 | strata_2), data = mydata, family=binomial) m_qualif &lt;- glmmTMB(Loneliness ~ Qualification + (1 | strata_2), data = mydata, family=binomial) m_full &lt;- glmmTMB(Loneliness ~ Age_class + Ethnicity + Sex + Urban + Qualification + (1 | strata_2), data = mydata, family=binomial) v_gender &lt;- get_variance(m_gender) v_ethnicity &lt;- get_variance(m_ethnicity) v_age &lt;- get_variance(m_age) v_urban &lt;- get_variance(m_urban) v_qualif &lt;- get_variance(m_qualif) v_full &lt;- get_variance(m_full) prop_gender &lt;- round(((v_null$var.random - v_gender$var.random) / v_null$var.random)*100,2) prop_gender &lt;- ifelse(is.null(prop_gender), 0, prop_gender) prop_ethnicity &lt;- round(((v_null$var.random - v_ethnicity$var.random) / v_null$var.random)*100,2) prop_ethnicity &lt;- ifelse(is.null(prop_ethnicity), 0, prop_ethnicity) prop_age &lt;- round(((v_null$var.random - v_age$var.random) / v_null$var.random)*100,2) prop_age &lt;- ifelse(is.null(prop_age), 0, prop_age) prop_qualif &lt;- round(((v_null$var.random - v_qualif$var.random) / v_null$var.random)*100,2) prop_qualif &lt;- ifelse(is.null(prop_qualif), 0, prop_qualif) prop_urban &lt;- round(((v_null$var.random - v_urban$var.random) / v_null$var.random)*100,2) prop_urban &lt;- ifelse(is.null(prop_urban), 0, prop_urban) prop_full &lt;- round(((v_null$var.random - v_full$var.random) / v_null$var.random)*100,2) prop_full &lt;- ifelse(is.null(prop_full), 100, prop_full) prop_intersection &lt;- round(100 - prop_full,2) print( as.data.frame( cbind( parameters = c(&quot;ICC/VPC&quot;, &quot;% Sex category&quot;, &quot;% Age/generation&quot;, &quot;% Ethnicity&quot;, &quot;% Life Place&quot;, &quot;% Qualification&quot;, &quot;%Intersection&quot;), values = c(ICC_intersect,prop_gender, prop_age, prop_ethnicity, prop_urban,prop_qualif, prop_intersection ) ))) ## parameters values ## 1 ICC/VPC 3.91 ## 2 % Sex category 31.8 ## 3 % Age/generation 13.09 ## 4 % Ethnicity 31.29 ## 5 % Life Place 27.21 ## 6 % Qualification 1.16 ## 7 %Intersection 5.35 ICC is 3.91%, which is low. This differences is mainly explained by ethnicity (31.29%), life place (27.21%) and sex category (31.8%). "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
