<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Simple example - continous outcome | MAIDHA | Very detailed examples</title>
  <meta name="description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Simple example - continous outcome | MAIDHA | Very detailed examples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Simple example - continous outcome | MAIDHA | Very detailed examples" />
  
  <meta name="twitter:description" content="<p>This is a very detailed example of using the MAIDHA approach to describe
intersectional phenomenon in biology and health.</p>" />
  

<meta name="author" content="H. Colineaux" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simple-example---binary-outcome.html"/>
<link rel="next" href="more-complexe-example---binary-outcome.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="create-stratas.html"><a href="create-stratas.html"><i class="fa fa-check"></i><b>2</b> Create stratas</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-stratas.html"><a href="create-stratas.html#choose-variables"><i class="fa fa-check"></i><b>2.1</b> Choose variables</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="create-stratas.html"><a href="create-stratas.html#a-first-simple-exemple-12-strata"><i class="fa fa-check"></i><b>2.1.1</b> A first simple exemple (12 strata)</a></li>
<li class="chapter" data-level="2.1.2" data-path="create-stratas.html"><a href="create-stratas.html#a-second-exemple-48-strata"><i class="fa fa-check"></i><b>2.1.2</b> A second exemple (48 strata)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="create-stratas.html"><a href="create-stratas.html#definition-and-description"><i class="fa fa-check"></i><b>2.2</b> Definition and description</a></li>
<li class="chapter" data-level="2.3" data-path="create-stratas.html"><a href="create-stratas.html#create-strata-variables"><i class="fa fa-check"></i><b>2.3</b> Create strata variables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="create-stratas.html"><a href="create-stratas.html#for-the-first-exemple-12-strata"><i class="fa fa-check"></i><b>2.3.1</b> For the first exemple (12 strata)</a></li>
<li class="chapter" data-level="2.3.2" data-path="create-stratas.html"><a href="create-stratas.html#for-the-second-exemple-48-strata"><i class="fa fa-check"></i><b>2.3.2</b> For the second exemple (48 strata)</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="create-stratas.html"><a href="create-stratas.html#plots-the-stratas-distribution"><i class="fa fa-check"></i><b>2.4</b> Plots the stratas distribution</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="create-stratas.html"><a href="create-stratas.html#for-the-first-exemple"><i class="fa fa-check"></i><b>2.4.1</b> For the first exemple</a></li>
<li class="chapter" data-level="2.4.2" data-path="create-stratas.html"><a href="create-stratas.html#for-the-second-exemple"><i class="fa fa-check"></i><b>2.4.2</b> For the second exemple</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-example---binary-outcome.html"><a href="simple-example---binary-outcome.html"><i class="fa fa-check"></i><b>3</b> Simple example - binary outcome</a>
<ul>
<li class="chapter" data-level="3.1" data-path="simple-example---binary-outcome.html"><a href="simple-example---binary-outcome.html#description"><i class="fa fa-check"></i><b>3.1</b> Description</a></li>
<li class="chapter" data-level="3.2" data-path="simple-example---binary-outcome.html"><a href="simple-example---binary-outcome.html#the-null-model-only-strata"><i class="fa fa-check"></i><b>3.2</b> The null model (only strata)</a></li>
<li class="chapter" data-level="3.3" data-path="simple-example---binary-outcome.html"><a href="simple-example---binary-outcome.html#the-variance-change"><i class="fa fa-check"></i><b>3.3</b> The variance change</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simple-example---continous-outcome.html"><a href="simple-example---continous-outcome.html"><i class="fa fa-check"></i><b>4</b> Simple example - continous outcome</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simple-example---continous-outcome.html"><a href="simple-example---continous-outcome.html#description-1"><i class="fa fa-check"></i><b>4.1</b> Description</a></li>
<li class="chapter" data-level="4.2" data-path="simple-example---continous-outcome.html"><a href="simple-example---continous-outcome.html#the-null-model-only-strata-1"><i class="fa fa-check"></i><b>4.2</b> The null model (only strata)</a></li>
<li class="chapter" data-level="4.3" data-path="simple-example---continous-outcome.html"><a href="simple-example---continous-outcome.html#the-variance-change-1"><i class="fa fa-check"></i><b>4.3</b> The variance change</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="more-complexe-example---binary-outcome.html"><a href="more-complexe-example---binary-outcome.html"><i class="fa fa-check"></i><b>5</b> More complexe example - binary outcome</a>
<ul>
<li class="chapter" data-level="5.1" data-path="more-complexe-example---binary-outcome.html"><a href="more-complexe-example---binary-outcome.html#description-2"><i class="fa fa-check"></i><b>5.1</b> Description</a></li>
<li class="chapter" data-level="5.2" data-path="more-complexe-example---binary-outcome.html"><a href="more-complexe-example---binary-outcome.html#the-null-model-only-strata-2"><i class="fa fa-check"></i><b>5.2</b> The null model (only strata)</a></li>
<li class="chapter" data-level="5.3" data-path="more-complexe-example---binary-outcome.html"><a href="more-complexe-example---binary-outcome.html#the-variance-change-2"><i class="fa fa-check"></i><b>5.3</b> The variance change</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MAIDHA | Very detailed examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simple-example---continous-outcome" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Simple example - continous outcome<a href="simple-example---continous-outcome.html#simple-example---continous-outcome" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As a working example, we want to explore intersectional inequalities in educaion length (a “late” intersectional strata) by early intersectional strata (12 stratas).</p>
<div id="description-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Description<a href="simple-example---continous-outcome.html#description-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="simple-example---continous-outcome.html#cb31-1" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span>AgeEducEnd_class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(mydata<span class="sc">$</span>AgeEducEnd <span class="sc">&lt;</span> <span class="fu">mean</span>(mydata<span class="sc">$</span>AgeEducEnd),</span>
<span id="cb31-2"><a href="simple-example---continous-outcome.html#cb31-2" aria-hidden="true" tabindex="-1"></a>                                                                     <span class="st">&quot;Below mean&quot;</span>, <span class="st">&quot;Above mean&quot;</span>))</span>
<span id="cb31-3"><a href="simple-example---continous-outcome.html#cb31-3" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span> Sex <span class="sc">+</span> Age_class <span class="sc">+</span> Ethnicity <span class="sc">|</span> AgeEducEnd_class,</span>
<span id="cb31-4"><a href="simple-example---continous-outcome.html#cb31-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>mydata,</span>
<span id="cb31-5"><a href="simple-example---continous-outcome.html#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">overall=</span><span class="fu">c</span>(<span class="at">left=</span><span class="st">&quot;Total&quot;</span>),</span>
<span id="cb31-6"><a href="simple-example---continous-outcome.html#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption=</span><span class="st">&quot;Description by age of education end&quot;</span>)</span></code></pre></div>
<div class="Rtable1"><table class="Rtable1"><caption>Description by age of education end</caption>

<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Total<br><span class='stratn'>(N=502461)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Above mean<br><span class='stratn'>(N=199714)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Below mean<br><span class='stratn'>(N=302747)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'>Sex</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Women</td>
<td>273354 (54.4%)</td>
<td>110322 (55.2%)</td>
<td>163032 (53.9%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Men</td>
<td class='lastrow'>229107 (45.6%)</td>
<td class='lastrow'>89392 (44.8%)</td>
<td class='lastrow'>139715 (46.1%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'>Age_class</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>-50</td>
<td>132145 (26.3%)</td>
<td>62549 (31.3%)</td>
<td>69596 (23.0%)</td>
</tr>
<tr>
<td class='rowlabel'>51-60</td>
<td>177222 (35.3%)</td>
<td>73933 (37.0%)</td>
<td>103289 (34.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>61+</td>
<td class='lastrow'>193094 (38.4%)</td>
<td class='lastrow'>63232 (31.7%)</td>
<td class='lastrow'>129862 (42.9%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'>Ethnicity</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Non White</td>
<td>27037 (5.4%)</td>
<td>14679 (7.4%)</td>
<td>12358 (4.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>White</td>
<td class='lastrow'>475424 (94.6%)</td>
<td class='lastrow'>185035 (92.7%)</td>
<td class='lastrow'>290389 (95.9%)</td>
</tr>
</tbody>
</table>
</div>
<p>We can plot the observed probability.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="simple-example---continous-outcome.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jpeg</span>(<span class="st">&quot;img/plot_12_quanti.jpeg&quot;</span>,</span>
<span id="cb32-2"><a href="simple-example---continous-outcome.html#cb32-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">1200</span>, <span class="at">height =</span> <span class="st">&quot;800&quot;</span>)</span>
<span id="cb32-3"><a href="simple-example---continous-outcome.html#cb32-3" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="simple-example---continous-outcome.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="simple-example---continous-outcome.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">mean</span>(AgeEducEnd)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="simple-example---continous-outcome.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(strata,value,<span class="at">.fun=</span><span class="st">&#39;median&#39;</span>),</span>
<span id="cb32-7"><a href="simple-example---continous-outcome.html#cb32-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span>value)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="simple-example---continous-outcome.html#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb32-9"><a href="simple-example---continous-outcome.html#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Stratas&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Age of Education End&quot;</span>,</span>
<span id="cb32-10"><a href="simple-example---continous-outcome.html#cb32-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Observed mean by stratas&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="simple-example---continous-outcome.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,  <span class="at">vjust=</span><span class="dv">1</span>,  <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb32-12"><a href="simple-example---continous-outcome.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<p><img src="img/plot_12_quanti.jpeg" /></p>
</div>
<div id="the-null-model-only-strata-1" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> The null model (only strata)<a href="simple-example---continous-outcome.html#the-null-model-only-strata-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The null model allows us to estimate the IntraClass correlation (ICC), also known as the Variance Partition Coefficient (VPC), that is the part of the outcome variance that can be explained by the strata.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="simple-example---continous-outcome.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multilevel model</span></span>
<span id="cb34-2"><a href="simple-example---continous-outcome.html#cb34-2" aria-hidden="true" tabindex="-1"></a>m_null <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(AgeEducEnd <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata),</span>
<span id="cb34-3"><a href="simple-example---continous-outcome.html#cb34-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> mydata)</span></code></pre></div>
<p>Outputs of the models:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="simple-example---continous-outcome.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_null)</span></code></pre></div>
<pre><code>##  Family: gaussian  ( identity )
## Formula:          AgeEducEnd ~ 1 + (1 | strata)
## Data: mydata
## 
##      AIC      BIC   logLik deviance df.resid 
##  2101612  2101645 -1050803  2101606   502458 
## 
## Random effects:
## 
## Conditional model:
##  Groups   Name        Variance Std.Dev.
##  strata   (Intercept) 0.2157   0.4645  
##  Residual             3.8366   1.9587  
## Number of obs: 502461, groups:  strata, 12
## 
## Dispersion estimate for gaussian family (sigma^2): 3.84 
## 
## Conditional model:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  17.1696     0.1342   127.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="simple-example---continous-outcome.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the variances:</span></span>
<span id="cb37-2"><a href="simple-example---continous-outcome.html#cb37-2" aria-hidden="true" tabindex="-1"></a>v_null <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_null)</span>
<span id="cb37-3"><a href="simple-example---continous-outcome.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between stratas variance:</span></span>
<span id="cb37-4"><a href="simple-example---continous-outcome.html#cb37-4" aria-hidden="true" tabindex="-1"></a>v_null<span class="sc">$</span>var.random</span></code></pre></div>
<pre><code>## [1] 0.2157245</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="simple-example---continous-outcome.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># intraclass correlation </span></span>
<span id="cb39-2"><a href="simple-example---continous-outcome.html#cb39-2" aria-hidden="true" tabindex="-1"></a>ICC_intersect <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">icc</span>(m_null)<span class="sc">$</span>ICC_unadjusted<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb39-3"><a href="simple-example---continous-outcome.html#cb39-3" aria-hidden="true" tabindex="-1"></a>ICC_intersect</span></code></pre></div>
<pre><code>## [1] 5.32</code></pre>
<p>Plot of the predicted values by strata:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="simple-example---continous-outcome.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb41-2"><a href="simple-example---continous-outcome.html#cb41-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict_response</span>(</span>
<span id="cb41-3"><a href="simple-example---continous-outcome.html#cb41-3" aria-hidden="true" tabindex="-1"></a>      m_null,</span>
<span id="cb41-4"><a href="simple-example---continous-outcome.html#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;strata&quot;</span>),</span>
<span id="cb41-5"><a href="simple-example---continous-outcome.html#cb41-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;random&quot;</span>) </span>
<span id="cb41-6"><a href="simple-example---continous-outcome.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb41-7"><a href="simple-example---continous-outcome.html#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(predicted) </span>
<span id="cb41-8"><a href="simple-example---continous-outcome.html#cb41-8" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>rown <span class="ot">=</span> <span class="fu">rownames</span>(predictions)</span>
<span id="cb41-9"><a href="simple-example---continous-outcome.html#cb41-9" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>x_lab <span class="ot">&lt;-</span> <span class="fu">paste0</span>(predictions<span class="sc">$</span>rown,<span class="st">&quot;.&quot;</span>,predictions<span class="sc">$</span>x)</span>
<span id="cb41-10"><a href="simple-example---continous-outcome.html#cb41-10" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Men&quot;</span>, predictions<span class="sc">$</span>x), <span class="st">&quot;Men&quot;</span>, <span class="st">&quot;Women&quot;</span>))</span>
<span id="cb41-11"><a href="simple-example---continous-outcome.html#cb41-11" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>ethnicity <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Non White&quot;</span>, predictions<span class="sc">$</span>x), <span class="st">&quot;Non white&quot;</span>, <span class="st">&quot;White&quot;</span>))</span>
<span id="cb41-12"><a href="simple-example---continous-outcome.html#cb41-12" aria-hidden="true" tabindex="-1"></a>    predictions<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;61+&quot;</span>, df<span class="sc">$</span>x), <span class="st">&quot;61+&quot;</span>,</span>
<span id="cb41-13"><a href="simple-example---continous-outcome.html#cb41-13" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;-50&quot;</span>, df<span class="sc">$</span>x), <span class="st">&quot;-50&quot;</span>,<span class="st">&quot;51-60&quot;</span>)))</span>
<span id="cb41-14"><a href="simple-example---continous-outcome.html#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">jpeg</span>(<span class="st">&quot;img/plot_quanti.jpeg&quot;</span>,</span>
<span id="cb41-15"><a href="simple-example---continous-outcome.html#cb41-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">1200</span>, <span class="at">height =</span> <span class="st">&quot;800&quot;</span>)</span>
<span id="cb41-16"><a href="simple-example---continous-outcome.html#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(predictions <span class="sc">%&gt;%</span> </span>
<span id="cb41-17"><a href="simple-example---continous-outcome.html#cb41-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>predicted, <span class="at">y=</span><span class="fu">fct_reorder</span>(x,predicted,<span class="at">.fun=</span><span class="st">&#39;median&#39;</span>),</span>
<span id="cb41-18"><a href="simple-example---continous-outcome.html#cb41-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> sex, <span class="at">linetype =</span> ethnicity))<span class="sc">+</span></span>
<span id="cb41-19"><a href="simple-example---continous-outcome.html#cb41-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-20"><a href="simple-example---continous-outcome.html#cb41-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high, <span class="at">size =</span> age))<span class="sc">+</span></span>
<span id="cb41-21"><a href="simple-example---continous-outcome.html#cb41-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&quot;Sratas&quot;</span>, </span>
<span id="cb41-22"><a href="simple-example---continous-outcome.html#cb41-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb41-23"><a href="simple-example---continous-outcome.html#cb41-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;Sex Category&quot;</span>,</span>
<span id="cb41-24"><a href="simple-example---continous-outcome.html#cb41-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> <span class="st">&quot;Ethnicity&quot;</span>,</span>
<span id="cb41-25"><a href="simple-example---continous-outcome.html#cb41-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb41-26"><a href="simple-example---continous-outcome.html#cb41-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Predicted values for Age of Education End&quot;</span>))<span class="sc">+</span></span>
<span id="cb41-27"><a href="simple-example---continous-outcome.html#cb41-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb41-28"><a href="simple-example---continous-outcome.html#cb41-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>)))<span class="sc">+</span> </span>
<span id="cb41-29"><a href="simple-example---continous-outcome.html#cb41-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_size_discrete</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>))</span>
<span id="cb41-30"><a href="simple-example---continous-outcome.html#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<p><img src="img/plot_quanti.jpeg" /></p>
</div>
<div id="the-variance-change-1" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> The variance change<a href="simple-example---continous-outcome.html#the-variance-change-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To calculate the (additive) contribution of each category to the total variance, we can estimate the variance change when adjusting for this category. The Proportional Variance Change (PVC) when adjusting for all categories is the portion of ICC/VPC explained by additive effect. Therefore 100% - PVC is the part explained by an intersectional effect .</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="simple-example---continous-outcome.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models where we add each category one by one</span></span>
<span id="cb43-2"><a href="simple-example---continous-outcome.html#cb43-2" aria-hidden="true" tabindex="-1"></a>m_gender <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(AgeEducEnd <span class="sc">~</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata)</span>
<span id="cb43-3"><a href="simple-example---continous-outcome.html#cb43-3" aria-hidden="true" tabindex="-1"></a>m_ethnicity <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(AgeEducEnd <span class="sc">~</span> Ethnicity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata)</span>
<span id="cb43-4"><a href="simple-example---continous-outcome.html#cb43-4" aria-hidden="true" tabindex="-1"></a>m_age <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(AgeEducEnd <span class="sc">~</span> Age_class <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata)</span>
<span id="cb43-5"><a href="simple-example---continous-outcome.html#cb43-5" aria-hidden="true" tabindex="-1"></a>m_full <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(AgeEducEnd <span class="sc">~</span> Age_class <span class="sc">+</span> Ethnicity <span class="sc">+</span> Sex <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> strata), <span class="at">data =</span> mydata)</span>
<span id="cb43-6"><a href="simple-example---continous-outcome.html#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="simple-example---continous-outcome.html#cb43-7" aria-hidden="true" tabindex="-1"></a>v_gender <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_gender)</span>
<span id="cb43-8"><a href="simple-example---continous-outcome.html#cb43-8" aria-hidden="true" tabindex="-1"></a>v_ethnicity <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_ethnicity)</span>
<span id="cb43-9"><a href="simple-example---continous-outcome.html#cb43-9" aria-hidden="true" tabindex="-1"></a>v_age <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_age)</span>
<span id="cb43-10"><a href="simple-example---continous-outcome.html#cb43-10" aria-hidden="true" tabindex="-1"></a>v_full <span class="ot">&lt;-</span> <span class="fu">get_variance</span>(m_full)</span>
<span id="cb43-11"><a href="simple-example---continous-outcome.html#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="simple-example---continous-outcome.html#cb43-12" aria-hidden="true" tabindex="-1"></a>prop_gender <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_gender<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb43-13"><a href="simple-example---continous-outcome.html#cb43-13" aria-hidden="true" tabindex="-1"></a>prop_gender <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_gender), <span class="dv">0</span>, prop_gender)</span>
<span id="cb43-14"><a href="simple-example---continous-outcome.html#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="simple-example---continous-outcome.html#cb43-15" aria-hidden="true" tabindex="-1"></a>prop_ethnicity <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_ethnicity<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb43-16"><a href="simple-example---continous-outcome.html#cb43-16" aria-hidden="true" tabindex="-1"></a>prop_ethnicity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_ethnicity), <span class="dv">0</span>, prop_ethnicity)</span>
<span id="cb43-17"><a href="simple-example---continous-outcome.html#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="simple-example---continous-outcome.html#cb43-18" aria-hidden="true" tabindex="-1"></a>prop_age <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_age<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb43-19"><a href="simple-example---continous-outcome.html#cb43-19" aria-hidden="true" tabindex="-1"></a>prop_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_age), <span class="dv">0</span>, prop_age)</span>
<span id="cb43-20"><a href="simple-example---continous-outcome.html#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="simple-example---continous-outcome.html#cb43-21" aria-hidden="true" tabindex="-1"></a>prop_full <span class="ot">&lt;-</span> <span class="fu">round</span>(((v_null<span class="sc">$</span>var.random <span class="sc">-</span> v_full<span class="sc">$</span>var.random) <span class="sc">/</span> v_null<span class="sc">$</span>var.random)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb43-22"><a href="simple-example---continous-outcome.html#cb43-22" aria-hidden="true" tabindex="-1"></a>prop_full <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(prop_full), <span class="dv">100</span>, prop_full)</span>
<span id="cb43-23"><a href="simple-example---continous-outcome.html#cb43-23" aria-hidden="true" tabindex="-1"></a>prop_intersection <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">-</span> prop_full,<span class="dv">2</span>)</span>
<span id="cb43-24"><a href="simple-example---continous-outcome.html#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="simple-example---continous-outcome.html#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="simple-example---continous-outcome.html#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb43-27"><a href="simple-example---continous-outcome.html#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(</span>
<span id="cb43-28"><a href="simple-example---continous-outcome.html#cb43-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(</span>
<span id="cb43-29"><a href="simple-example---continous-outcome.html#cb43-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> <span class="fu">c</span>(<span class="st">&quot;ICC/VPC&quot;</span>, <span class="st">&quot;% Sex category&quot;</span>, <span class="st">&quot;% Age/generation&quot;</span>, <span class="st">&quot;% Ethnicity&quot;</span>, <span class="st">&quot;%Intersection&quot;</span>),</span>
<span id="cb43-30"><a href="simple-example---continous-outcome.html#cb43-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(ICC_intersect,prop_gender, prop_age, prop_ethnicity,prop_intersection )</span>
<span id="cb43-31"><a href="simple-example---continous-outcome.html#cb43-31" aria-hidden="true" tabindex="-1"></a>  )))</span></code></pre></div>
<pre><code>##         parameters values
## 1          ICC/VPC   5.32
## 2   % Sex category   2.59
## 3 % Age/generation   9.55
## 4      % Ethnicity  81.07
## 5    %Intersection   6.62</code></pre>
<p>ICC is 5.32%, which is moderate. This differences is mainly explained by ethnicity (81.07%), age (9.55%) and an intersectional effect (6.62%).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simple-example---binary-outcome.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="more-complexe-example---binary-outcome.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
